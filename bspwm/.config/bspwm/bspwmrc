#!/bin/sh

#                      ___           ___         ___           ___
#       _____         /  /\         /  /\       /__/\         /__/\
#      /  /::\       /  /:/_       /  /::\     _\_ \:\       |  |::\
#     /  /:/\:\     /  /:/ /\     /  /:/\:\   /__/\ \:\      |  |:|:\
#    /  /:/~/::\   /  /:/ /::\   /  /:/~/:/  _\_ \:\ \:\   __|__|:|\:\
#   /__/:/ /:/\:| /__/:/ /:/\:\ /__/:/ /:/  /__/\ \:\ \:\ /__/::::| \:\
#   \  \:\/:/~/:/ \  \:\/:/~/:/ \  \:\/:/   \  \:\ \:\/:/ \  \:\~~\__\/
#    \  \::/ /:/   \  \::/ /:/   \  \::/     \  \:\ \::/   \  \:\
#     \  \:\/:/     \__\/ /:/     \  \:\      \  \:\/:/     \  \:\
#      \  \::/        /__/:/       \  \:\      \  \::/       \  \:\
#       \__\/         \__\/         \__\/       \__\/         \__\/
#

screen_size=$(xrandr | awk '/connected primary/{print $4}')

bspc monitor -d 1 2 3 4 5 6 7 8 9 0

bspc config border_width				2
bspc config window_gap					4
bspc config split_ratio					0
bspc config pointer_modifier			mod4
bspc config borderless_monocle			true
bspc config gapless_monocle				true
bspc config focus_follows_pointer		true

if [ "$(hostname)" = "home" ]; then
	bspc config left_padding			664
	bspc config right_padding			0
	bspc config bottom_padding			224
else
	bspc config left_padding			0
	bspc config right_padding			0
	bspc config bottom_padding			0
fi

bspc config focused_border_color		"#353535"
bspc config active_border_color			"#191919"
bspc config normal_border_color			"#191919"
bspc config presel_feedback_color		"#353535"

# Rules

bspc rule -a 'Code' desktop='^2' follow=on
bspc rule -a 'Subl3' desktop='^2' follow=on
bspc rule -a 'neovim' desktop='^2' follow=on
bspc rule -a 'Chromium' desktop='^3' follow=on
bspc rule -a 'firefox' desktop='^3' follow=on
bspc rule -a 'Thunar' desktop='^4' follow=on
bspc rule -a 'Gtk3-youtube-viewer' desktop='^4' follow=on
bspc rule -a 'vlc' desktop='^5' follow=on
bspc rule -a 'mpv' desktop='^5' follow=on
bspc rule -a 'Atril' desktop='^5' follow=on
bspc rule -a 'TelegramDesktop' desktop='^6' follow=on
bspc rule -a 'Deezloader Remix' desktop='^6' follow=on
bspc rule -a 'Thunderbird' desktop='^7' follow=on
bspc rule -a 'neomutt' desktop='^7' follow=on
bspc rule -a 'Caprine' desktop='^7' follow=on
bspc rule -a 'Kodi' desktop='^7' follow=on
bspc rule -a 'TeamViewer' desktop='^9' follow=on

bspc rule -a 'MEGAsync' follow=on state=floating
bspc rule -a 'com-rarchives-ripme-App' follow=on state=floating
bspc rule -a 'java-lang-Thread:java-lang-Thread' state=floating
bspc rule -a 'st-popup' follow=on layer=above state=floating hidden=on sticky=on border=off rectangle=$screen_size

# Etc
# kill `ps -aux | grep SCRIPT | grep -v grep | awk '{ print $2 }'` > /dev/null 2>&1

/usr/bin/wmname LG3D &
/usr/bin/nitrogen --restore &
/usr/lib/jvm/java-13-openjdk/bin/java -jar /opt/xdman/xdman.jar -m &

# {
# 	killall -q -w compton
# 	compton --config ~/.config/compton/compton.conf &
# } &

{
	killall -q -w xfce4-notifyd dunst
	dunst &
} &

{
	mkdir -p $HOME/.local/share/mpd/playlists
	mpd ~/.config/mpd/mpd.conf &
} &

{
	killall -q -w play-with-mpv
	play-with-mpv &
} &

{
	killall -q -w polybar
	polybar top &
} &

{
	killall -q -w sxhkd
	sxhkd &
} &

{
	killall -q -w syncthing
	syncthing -no-browser -home=$HOME/.config/syncthing -gui-address="http://127.0.0.1:3838" &
} &

[ ! "$(xdo id -N st-popup)" ] && {
    $HOME/.scripts/st-popup.sh &
} &

[ ! "$(xdo id -N st-256color -n st-256color)" ] && {
    bspc rule -a 'st-256color:st-256color' --one-shot desktop='^1' follow=off
    st &
} &
